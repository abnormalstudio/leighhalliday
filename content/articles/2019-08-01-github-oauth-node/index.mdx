---
title: GitHub OAuth in Node
slug: github-oauth-node
tags: javascript, node, github, oauth, nextjs
date: 2019-08-01
updated: 2019-08-01
banner: ./banner.jpg
---

If you have a developer centric website, having GitHub connect as an authentication option may be a better choice than using MySpace Connect (does that exist??). GitHub provides a great guide on how to create an app and go through the OAuth flow, but it stops short by not providing examples on how to perform each step in actual code.

For this article we are going

## Create a GitHub Application

```json
{
  "name": "GitHub OAuth",
  "version": 2,
  "routes": [
    {
      "src": "/auth/connect",
      "dest": "/api/auth/connect"
    },
    {
      "src": "/auth/login",
      "dest": "/api/auth/login"
    }
  ],
  "builds": [
    {
      "src": "package.json",
      "use": "@now/next"
    }
  ],
  "env": {
    "BASE_URL": "http://localhost:3000",
    "GITHUB_CLIENT_ID": "123456",
    "GITHUB_CLIENT_SECRET": "d2534f1ee3ccdfaasdfas343423gfdsfa11fe1b96f297",
    "JWT_SECRET": "d2534f1ee3ccdfaasdfas343423gfdsfa11fe1b96f297"
  }
}
```

## Redirect To GitHub

When the user decides to log in to your website with GitHub, we'll direct them to the page `/auth/login`. The purpose of this endpoint is to redirect them to GitHub. On GitHub they are asked to authenticate (if they aren't already logged in) and then to give permission to your app (if they haven't already done so).

```ts
import { IncomingMessage, ServerResponse } from "http";
import { buildURL } from "../../../src/utils";

export default function(req: IncomingMessage, res: ServerResponse) {
  res.writeHead(302, {
    Location: buildURL(`https://github.com/login/oauth/authorize`, {
      client_id: process.env.GITHUB_CLIENT_ID,
      redirect_uri: `${process.env.BASE_URL}/auth/connect`,
      scopes: ""
    })
  });
  return res.end();
}
```

## Exchange Code

After the user has been redirected back to our site, they'll be sent to the `/auth/connect` page. The URL will receive a `code` query param which we are required to exchange for a valid access token. Once we have the access token we can request the user's details.

```ts
import { IncomingMessage, ServerResponse } from "http";
import axios from "axios";
import { parse } from "url";

async function exchangeCode(code: string) {
  return await axios.post(
    "https://github.com/login/oauth/access_token",
    {
      client_id: process.env.GITHUB_CLIENT_ID,
      client_secret: process.env.GITHUB_CLIENT_SECRET,
      redirect_uri: `${process.env.BASE_URL}/auth/connect`,
      code
    },
    {
      headers: {
        Accept: "application/json"
      }
    }
  );
}

export default async function(req: IncomingMessage, res: ServerResponse) {
  try {
    const { query = {} } = parse(req.url || "", true);
    const { code } = query;
    const codeResponse = await exchangeCode(code as string);

    console.log(codeResponse.data);

    res.end();
  } catch (e) {
    console.error(e);
    return res.end("Error...");
  }
}
```

## Fetch User Details

```ts
async function getUser(accessToken) {
  return await axios.get("https://api.github.com/user", {
    headers: {
      Authorization: `token ${accessToken}`
    }
  });
}

export default async function(req: IncomingMessage, res: ServerResponse) {
  try {
    // ... exchange code for access token
    const userResponse = await getUser(codeResponse.data.access_token);
    const githubData: GithubData = userResponse.data;

    console.log(githubData);

    res.end();
  } catch (e) {
    console.error(e);
    return res.end("Error...");
  }
}
```

## Authenticate User

## Conclusion
